<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link rel=stylesheet href=https://unpkg.com/spectre.css/dist/spectre.min.css><link rel=stylesheet href=https://unpkg.com/spectre.css/dist/spectre-exp.min.css><link rel=stylesheet href=https://unpkg.com/spectre.css/dist/spectre-icons.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/nnfx-dark.min.css><link rel=stylesheet href=https://pro.fontawesome.com/releases/v5.10.0/css/all.css integrity=sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p crossorigin=anonymous><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.81.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>[AWS] Deploy Docker Containers on ECS &#183; Ming's Site</title><meta name=description content><link type=text/css rel=stylesheet href=https://minghsu0107.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://minghsu0107.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://minghsu0107.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://minghsu0107.github.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><style>pre,code{white-space:pre;overflow-x:scroll}.hljs{display:inline-block;overflow-x:scroll;padding-right:100%;background:0 0;color:#fff;-webkit-text-size-adjust:none;min-width:2300px}</style><style>@import "https://fonts.googleapis.com/css?family=Open+Sans";body{font-family:open sans,sans-serif}.searchTerm{border-radius:5px;width:100%;border:1px solid #00b4cc;padding:5px}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-96ZZVQWZLF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-96ZZVQWZLF')</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/yaml.min.js></script><script>hljs.initHighlightingOnLoad()</script><body><aside class=sidebar><div class=container><div class=sidebar-about><a href=https://minghsu0107.github.io/><h1>Ming's Site</h1></a><p class=lead><a href=https://github.com/minghsu0107><i class="fab fa-github"></i></a>&nbsp;&nbsp;<a href=https://linkedin.com/in/hao-ming-hsu-178176181> <i class="fab fa-linkedin"></i></a><br><a href=/about>Hao-Ming Hsu (許浩鳴)</a><br>Learn by Doing.<br><a href=https://github.com/minghsu0107>@minghsu0107</a></p></div><nav><ul class=sidebar-nav><li><a href=/about>About</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></nav><section class="resume-section p-3 p-lg-5 d-flex flex-column" style="margin:0 auto"><div><form action=https://minghsu0107.github.io/search><input placeholder=search class=searchTerm id=search-query name=s></form></div></section><br><p>&copy; 2021. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>[AWS] Deploy Docker Containers on ECS</h1><time datetime=2021-05-14T16:46:12+0800 class=post-date>Fri, May 14, 2021 &#183; <span class=read-time>2 min read</span></time><p>We are going to deploy a sample app container on Amazon ECS using Fargate, a serverless compute engine for containers. Fargate removes the need to provision and manage servers, lets us specify and pay for resources per application, and improves security through application isolation by design.</p><p><img src=https://i.imgur.com/eu6ck9F.png alt></p><h2 id=steps>Steps</h2><p>First, click <code>get started</code> to create a cluster from the startup template.</p><p><img src=https://i.imgur.com/9qDJ5Q7.png alt></p><p>Configure container definition and task definition. Choose <code>sample-app</code> image and the use the default task definition. This will create a task execution role automatically, which gives right permissions to ECS tasks.</p><p><img src=https://i.imgur.com/k3JGjLX.png alt></p><p>Next, define the service. A service lets us specify how many copies of task definition to run and maintain in a cluster. We can optionally use an Elastic Load Balancing (ELB) load balancer to distribute incoming traffic to containers in the service. Amazon ECS maintains that number of tasks and coordinates task scheduling with the load balancer. We can also optionally use Service Auto Scaling to adjust the number of tasks in the service. Here, we will use an Application Load Balancer (ALB) to route incoming requests to our sample app.</p><p><img src=https://i.imgur.com/YechdR4.png alt></p><p>Finally, configure your ECS cluster. We could either create a new VPC and subnets automatically or attach an existed VPC to our cluster.</p><p><img src=https://i.imgur.com/FwIQtyn.png alt></p><p>Overview:</p><p><img src=https://i.imgur.com/GzunaSt.png alt></p><p>Watch the ECS cluster lauch status. The creation takes a few minutes.</p><p><img src=https://i.imgur.com/PiIDKux.png alt></p><p>After the creation is completed, we can see that there is one service and one running task in our cluster. A task is the instantiation of a task definition within a cluster. After you have created a task definition for your application within Amazon ECS, you can specify the number of tasks to run on your cluster.</p><p><img src=https://i.imgur.com/6uz5ORi.png alt></p><p>Check the service details. We can see that our task, load balancing, and networking all work successfully.</p><p><img src=https://i.imgur.com/2fQbetA.png alt></p><p>Click <code>Tasks</code> tab and check details of our only task. In the <code>Network</code> section, we can see the auto-assign public IP (<code>18.188.40.78</code>) of our container.</p><p><img src=https://i.imgur.com/ZUHZUmK.png alt></p><p>Visit <code>18.188.40.78</code> and we will see our sample app running.</p><p><img src=https://i.imgur.com/4ZKRHjR.png alt></p><p>We could also visit our sample app through our Application Load Balancer. Check DNS name of your ALB in the <a href=https://console.aws.amazon.com/ec2/v2/home#LoadBalancers>Load Balancer Dashboard</a>:</p><p><img src=https://i.imgur.com/7esMDnw.png alt></p><p>Visit <code>EC2Co-EcsEl-PR126DKAQE76-1958981970.us-east-2.elb.amazonaws.com</code>:</p><p><img src=https://i.imgur.com/HJ8DMnL.png alt></p><p>Optionally, we could enable container auto scaling. By specifying minimum/maximum number of tasks, we are able to adjust number of running tasks dynamically.</p><p>The startup template creates a ECS cluster using a CloudFormation stack template. Let&rsquo;s see what resources it have created for us.</p><p><img src=https://i.imgur.com/H1tcciy.png alt></p><p><img src=https://i.imgur.com/PCYsYrm.png alt>
<img src=https://i.imgur.com/qbcsDlN.png alt></p><p>A default VPC for ECS is created:</p><p><img src=https://i.imgur.com/QNXVNRD.png alt></p><p>Two security groups are created: an Application Load Balancer security group that allows all traffic on the Application Load Balancer port (HTTP) and an Amazon ECS security group that allows all traffic on the HTTP port or all traffic ONLY from the Application Load Balancer security group.</p><p><img src=https://i.imgur.com/QgG7gZx.png alt></p><p><img src=https://i.imgur.com/YbTQc0c.png alt></p><p>Two subnets, PublicSubnetAz1 (AZ: <code>us-east-2a</code>) and PublicSubnetAz2 (AZ: <code>us-east-2b</code>) in the default VPC are created:</p><p><img src=https://i.imgur.com/qDtjoTN.png alt></p><p>Note that our container is abled to be assigned a public IP because it is in a public subnet, to which an Internet Gatway is attached.</p><p>Finally, we could delete the cluster by clicking <code>Delete</code> on the cluster dashboard. This will delete all resources we have created.</p><h2 id=appendix---using-images-on-ecr>Appendix - Using Images on ECR</h2><p>An Amazon <strong>ECS task execution role</strong> is automatically created in the Amazon ECS console first-run experience. Thus, we only need to <strong>ensure that our ECS owner is as same as our ECR owner in order to pull images successfully</strong>.</p><p>In <code>Container definition</code> section of the startup template, choose the custom image:</p><p><img src=https://i.imgur.com/RPrIwQ0.png alt></p><p>We need to specify port mappings of the container so that the Elastic Load Balancing load balancer knows which ports of the container it should send to.</p></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=minghsu0107/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></main></body></html>