<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link rel=stylesheet href=https://unpkg.com/spectre.css/dist/spectre.min.css><link rel=stylesheet href=https://unpkg.com/spectre.css/dist/spectre-exp.min.css><link rel=stylesheet href=https://unpkg.com/spectre.css/dist/spectre-icons.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/nnfx-dark.min.css><link rel=stylesheet href=https://pro.fontawesome.com/releases/v5.10.0/css/all.css integrity=sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p crossorigin=anonymous><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1"><title>COSCUP X Cloud Native &#183; Ming's Site</title><meta name=description content="與大家分享我在 COSCUP 2021 擔任 Cloud Native 議程講者的一些內容簡介與感想。雖然這次是線上議程，但大家在各平台上的積極發問與留言實在令人感到社群滿滿的活力。

這次我分享的主題是 &#34;Empower Your Kubernetes with Service Mesh + Distributed Tracing&#34;，主要介紹了 service mesh 與 distributed tracing 的基礎概念，並帶領大家以 kubernetes-native 的方式實際部署一個範例應用，將 distributed tracing 與 service mesh 無縫整合。"><link type=text/css rel=stylesheet href=https://minghsu.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://minghsu.io/css/poole.css><link type=text/css rel=stylesheet href=https://minghsu.io/css/syntax.css><link type=text/css rel=stylesheet href=https://minghsu.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><style>pre,code{white-space:pre;overflow-x:scroll}.hljs{display:inline-block;overflow-x:scroll;padding-right:100%;background:0 0;color:#fff;-webkit-text-size-adjust:none;min-width:2300px}</style><style>@import "https://fonts.googleapis.com/css?family=Open+Sans";body{font-family:open sans,sans-serif}.searchTerm{border-radius:5px;width:100%;border:1px solid #00b4cc;padding:8px 12px}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-96ZZVQWZLF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-96ZZVQWZLF')</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/yaml.min.js></script><script>hljs.initHighlightingOnLoad()</script><body><aside class=sidebar><div class=container><div class=sidebar-about><a href=https://minghsu.io/><h1>Ming's Site</h1></a><p class=lead><a href=https://github.com/minghsu0107><i class="fab fa-github"></i></a>&nbsp;&nbsp;<a href=https://linkedin.com/in/hao-ming-hsu-178176181> <i class="fab fa-linkedin"></i></a><br><a href=/about>Hao-Ming Hsu (許浩鳴)</a><br>Learn by Doing.<br><a href=https://github.com/minghsu0107>@minghsu0107</a></p></div><nav><ul class=sidebar-nav><li><a href=/about>About</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></nav><div style="margin:0 auto"><form action=https://minghsu.io/search><input placeholder=search class=searchTerm id=search-query name=s></form></div><br><p>&copy; 2021. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>COSCUP X Cloud Native</h1><time datetime=2021-08-08T12:12:23+0800 class=post-date>Sun, Aug 8, 2021 &#183; <span class=read-time>5 min read</span></time><div class=chip><a href=https://minghsu.io/tags/coscup//>COSCUP</a></div><div class=chip><a href=https://minghsu.io/tags/cloud-native//>Cloud-Native</a></div><div class=chip><a href=https://minghsu.io/tags/golang//>Golang</a></div><br><br><p>與大家分享我在 COSCUP 2021 擔任 Cloud Native 議程講者的一些內容簡介與感想。雖然這次是線上議程，但大家在各平台上的積極發問與留言實在令人感到社群滿滿的活力。</p><p>這次我分享的主題是 &ldquo;Empower Your Kubernetes with Service Mesh + Distributed Tracing&rdquo;，主要介紹了 service mesh 與 distributed tracing 的基礎概念，並帶領大家以 kubernetes-native 的方式實際部署一個範例應用，將 distributed tracing 與 service mesh 無縫整合。</p><script async class=speakerdeck-embed data-slide=3 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>Service mesh 是個提供應用程式安全性、可靠性、監控功能、並且快速的平台基礎設施。它接管了微服務之間複雜的網路溝通，並且提供開箱即用的負載均衡、憑證管理、流量控制、與監控追蹤等功能，而應用程式不會意識到它的存在。</p><script async class=speakerdeck-embed data-slide=8 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>Service mesh 為我們節省了團隊開發上的溝通成本，它將與應用本身無關的一切網路相關實作轉移到 Kubernetes 上，並且透明可調控。除此之外，service mesh 甚至可以橫跨多個叢集，這對於使用混合雲等注重資料安全的企業無疑是個的好選擇。</p><script async class=speakerdeck-embed data-slide=9 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>這邊介紹一個很棒的 service mesh 開源方案 &ndash; Linkerd。相較於其他的 service mesh，比如當前很流行的 Istio，Linkerd 更輕量、好上手與易維護，而且他的功能齊全、運行快速且使用很少的資源。</p><script async class=speakerdeck-embed data-slide=10 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>Linkerd 為我們的應用提供了三大 golden metrics，分別是 success rate、rps、與 latency。這三大項指標幫助我們更能了解應用程式運行時可能發生的瓶頸，而這些 metrics 都可以輕鬆的在 Linkerd 的 dashboard 上觀測。</p><script async class=speakerdeck-embed data-slide=13 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>另一方面，distributed tracing 則是在分散式系統中觀察請求與流量的一系列技術。它讓微服務之間的流量變得透明而易追蹤，在系統效能評測與除錯近來已被廣泛使用。藉由 distributed tracing，我們得以跨越 service boundary 追蹤所有被請求的服務 (End-to-End Visibility)，並由 latencies 分析與了解系統瓶頸。除此之外，我們更可以輕鬆得到所有服務的依賴關係圖。</p><script async class=speakerdeck-embed data-slide=16 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>在收集 log 與 tracing span 方面，推薦大家使用 Grafana + Loki + Jaeger 這個 techstack。Grafana 是個非常彈性又功能強大的 dashboard，他可以幫我們彙整所有的 metrics 並繪製成各種圖表，同時也可設定各種警報機制以在問題發生時第一時間通知維運人員。Loki 則是一款輕量的 log 收集系統，他在每個叢集節點上運行一個 daemon (Daemonset)、收集 container 的 log，最後推送到存儲系統。而 Jaeger 是一套功能完善的分布式追蹤系統，他幫助開發者輕鬆的為應用程式加上追蹤的功能。</p><script async class=speakerdeck-embed data-slide=18 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>Service mesh 與 distributed tracing 兩者皆可分析 service health、latency 與 topology 。然而 Service mesh 除了 observability 外也提供安全性與流量管控，且其為無狀態的設計，因此若要永久保存 trace 還是需要用到 Jaeger 等分布式追蹤方案，我們該如何結合兩者呢？</p><p>話不多說，我們實際部署一個範例應用來直接學習如何結合 service mesh 與 distributed tracing，這是一個簡單的表情符號投票系統，包含了以下四個微服務。</p><ul><li>voting - 負責表情符號的投票</li><li>emoji - 負責列出所有的表情符號</li><li>web - UI 介面</li><li>vote-bot - 一個不斷投票以產生流量的程式</li></ul><p>其中 vote-bot 以 REST API 訪問 web，接著 web 會以 gRPC API 訪問 voting 與 emoji 微服務。</p><script async class=speakerdeck-embed data-slide=27 data-id=15d69d4ce9204cb2aa56855ece74ae02 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>我把所有程式碼都放在<a href=https://github.com/minghsu0107/emojivoto-kustomization>這裡</a>，這個範例包含了以下的內容：</p><ol><li>在 Kubernetes 上運行 Linkerd 與 Jaeger backend</li><li>啟用 Linkerd 的 tracing 功能並連接 Jaeger backend</li><li>在 Linkerd 上部署微服務並注入 Linkerd proxy</li><li>使用 Opencensus Collector 串接 application 與 Linkerd proxy 的 span</li></ol><p>總體來說，今年的與會者眾多，大家非常踴躍的發問與樂於分享技術，而各攤位的 short talk 也都非常有深度，讓人收穫良多。最後特別感謝 LINE 的贊助，讓我有機會站上這樣的舞台與大家分享技術！</p></div><h2>Read More</h2><ul><li><a href=https://minghsu.io/posts/aws-cloudfront-with-signed-url/>[AWS] AWS CloudFront with Signed URL</a></li><li><a href=https://minghsu.io/posts/http-context/>Passing Parameters in Golang HTTP Context</a></li><li><a href=https://minghsu.io/posts/event-driven-golang-taipei-55/>輕鬆「Go」建事件驅動應用</a></li><li><a href=https://minghsu.io/posts/first-post/>我如何架設這個部落格的？</a></li></ul><h2>Comments</h2><script src=https://utteranc.es/client.js repo=minghsu0107/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></main></body></html>